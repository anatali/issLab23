<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
 
<style type="text/css"> 
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 80%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 80%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	 
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	 
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	width: 700px;
    font-size: 15px;
}
k{
    color: #990000;
	font-weight: bold;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px; 
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #C0F0E0;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;
	
}    
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}       
div.remark{
	background-color: #ffffff;	
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}  
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
} 

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}     

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed
	
}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}   
</style>
    
<head>
   
<title>Mbot2020</title></head>
    
<body>
<div id="body">
<h1>Mbot2020 | The reference ddr robot</h1>

<h2>Hardware</h2>

 <ol>
 <li>  
The robot <br/> 
<table style="width:98%">
<tbody>	
<tr>
<td style="width:50%" >
<h3>MBOT (wifi) base</h3>
 
<a href="https://www.robotstore.it/Makeblock-mBot-S-Explorer-Kit" target="web">https://www.robotstore.it/Makeblock-mBot-S-Explorer-Kit</a>
<br/> 
<img src="./img/mbot-S.jpg" alt="mbot-S" width="70%" /> 
 

</td>
<td>
<h3>MBOT as an IOT device</h3>
<a href="https://en.wikipedia.org/wiki/Internet_of_things" target="web">https://en.wikipedia.org/wiki/Internet_of_things</a>
<br/><br/> 
<img src="./img/mbot.png" alt="mbot" width="80%" /><br/> <br/> 
</td>
</tr>
 </tbody>
</table>
<br/><br/> 
 
 
  </li>
 
<li><b>Raspberry PI 3 Model B+</b> (42,85)<br/> 
<b>Wires</b>	 	 
<a href="https://www.amazon.it/Elegoo-Multicolore-FFemmina-MEGA2560-Raspberry/dp/B01N40EK6M/ref=sr_1_3?s=english-books&ie=UTF8&qid=1505917408&sr=8-3&keywords=cavetti+raspberry" target="web">
male-male / male-female / female-female</a>
<br/>
<b>Distance Sensor</b>
    <a href="http://www.amazon.it/gp/product/B00E0NXTJW?psc=1&redirect=true&ref_=oh_aui_detailpage_o03_s00" target="ddr">Sonar HC-SR04</a>
 


<br/> <br/> 
</li>
<li>    
<b>Batteria</b>	<a href="http://www.amazon.it/gp/product/B00Y03M2XQ?psc=1&redirect=true&ref_=oh_aui_detailpage_o02_s00" target="web">
    EasyAcc Colorato 10000mAh</a> (19,99)
 

</li>    
</ol>

<h2><a href="https://en.wikipedia.org/wiki/Edge_computing" target="web">Edge</a> : the Arduino layer</h2>

<a href="../resources/arduino/uniboControl/uniboControl.ino" target="code">uniboControl.ino</a>  (baudrate <bc>115200</bc>).

<br/> <br/>
The <em>Robot</em> is able to execute a set of <i>movement-commands</i>:
<ul>
<li> <k>w</k>: forward</li>
<li> <k>s</k>: backward</li>
<li> <k>a</k>: rotate left</li>
<li> <k>d</k>: rotate right</li>
<li> <k>r</k>: rotate left <tt>90</tt> degrees</li>
<li> <k>l</k>: rotate right <tt>90</tt> degrees</li>
<li> <k>x</k>: rotate left <tt>10</tt> degrees</li>
<li> <k>l</k>: rotate right <tt>10</tt> degrees </li>
<li> <k>h</k>: stop the robot movement</li>
</ul>

<h3>Arduino connected a <a href="../../it.unibo.raspIntro2020/userDocs/LabRaspiIntro.html" target="lab">RaspberryPi</a> (i.e. on Linux)</h3>

A Python program that allows us to send commands to Arduino using the serial line:
 <a href="../resources/python/testSerial.py" target="code">testSerial.py</a> 
<pre>
sudo apt-get install python3-serial		//just once ...
</pre>
A NodeJs program that allows us to send commands to Arduino using the serial line:
 <a href="../resources/node/testSerial.js" target="code">testSerial.js</a>
<pre>
npm install serialport		//just once ...
node testSerial
</pre>

<h3>A robot-usage utility</h3>
The Kotlin object <a href="../resources/robotMbot/mbotSupport.kt" target="code">mbotSupport.kt</a>
provides an  utility that allows application designers to
send commands the robot actuators without knowing any detail of their low-level configuration.
<br/>
Moreover, this utility creates (if required) a data-source 
(the actor <a href="../resources/robotMbot/robotDataSourceArduino.kt" target="code">robotDataSourceArduino.kt</a>)
that works as a <a href="../../it.unibo.qakactor/userDocs/LabQakIntro2021.html#actorasstream " target="lab">event stream</a> source
with respect to the data generated by the robot sonar on Arduino.
<br/><br/>
Since a sonar usually emits data with a quite high frequency and since these data are sometimes not reliable, the application
designer could conveniently create a pipe including a data-cleaner and some filter.<br/>

<img src="./img/sonarPipembot.png" alt="sonarPipembot.png" width="50%"  />
 

<ul>
<li><a href="../resources/rx/dataCleaner.kt" target="code">dataCleaner.kt</a>: eliminates data outside a prefixed interval of values</li>
<li><a href="../resources/rx/distanceFilter.kt" target="code">distanceFilter.kt</a>: emits an <m><ks>obstacle : obstacle( D )</ks></m> event
when the sonar distance is less than a prefixed limit</li>
</ul>

 
<h2>High-level demo</h2>
 
<table style="width:98%">
<tbody>	

<!--
<tr>
<td style="width:40%" >

<a href="../src/mbotdemo.qak" target="code">mbotdemo.qak</a>
<m>
 
</m>
</td>

<td><m>
This application creates the pipe described above and handles robot-move commands sent via TCP, MQTT or Coap.
<br/>
 

</m>
</td>
</tr>
-->

<tr>
<td><img src="./img/consoleCoap.png" alt="consoleCoap.png" width="60%"  /></td>
<td>
An utility to send commands is defined in the project 
<a href="../../it.unibo.qak21.robots" target="code"><bc>it.unibo.qak21.robots</bc></a>:
<ul>
<li><a href="../../it.unibo.qak21.robots/resources/consoles/consoleGuiTcp.kt" target="code">consoleGuiTcp.kt</a></li>
<li><a href="../../it.unibo.qak21.robots/resources/consoles/consoleGuiMqtt.kt" target="code">consoleGuiMqtt.kt</a></li>
<li><a href="../../it.unibo.qak21.robots/resources/consoles/consoleGuiCoap.kt" target="code">consoleGuiCoap.kt</a></li>
</ul>
All these utilities inherit from
<li><a href="../../it.unibo.qak21.robots/resources/consoles/consoleGuiSimple.kt" target="code">consoleGuiSimple.kt</a></li>

and make reference to the configuration object:
<a href="../../it.unibo.qak21.robots/resources/consoles/sysConnKb.kt" target="code">sysConnKb.kt</a>
</td>
</tr>

</tbody>
</table>

<!--
 <h2>Remote control</h2>
 <center>
<table style="width:85%">
<tbody>	
<tr>
<td style="width:80%" >
<h3>A NodeJs HTTP server</h3>
 A  <a href="https://www.w3schools.com/nodejs/" target="web">Node.js</a>
server that allows us to send commands to Arduino using a Web-Gui (<tt>HTTP</tt>):

	<ul>
	<li><a href="../resources/nodeCode/package.json" target="code">package.json</a></li>
	<li><a href="../resources/nodeCode/app.js" target="code">app.js</a></li>
	<li><pre>npm install 
node app.js</pre></li>
	</ul>
	
Usage: 
<ul>
<li>Click on a button: send a <tt>POST</tt> request</li>
<li>Write on a browser <tt>http://192.168.x.y:3000/r</tt>: sends a <tt>GET</tt> that moves the robot => <bc>WARNING</bc>
<a href="https://en.wikipedia.org/wiki/Representational_state_transfer" target="web">REST principles</a> violated!</li>
</ul>

</td>
<td>
<img src="./img/probotnode.png" alt="probotnode" width="80%"/>
</td>
</tr>
 </tbody>
</table>
</center>

 <h2>Web cam</h2>
<pre>
cd /home/pi/nat/mjpg-streamer/mjpg-streamer-experimental
./start.sh 			<kc>or</kc> bash start.sh
<ks>http://192.168.x.y:8080/stream.html</ks>   
</pre>
<br/><br/>
-->
<!--
<br/><br/>
 <center>
<table style="width:85%">
<tbody>	
<tr>
<td style="width:80%" >
<h3>CoAP interaction using a Server written in Python </h3>
Use <a href="https://aiocoap.readthedocs.io/en/latest/" target="web">aiocoap</a>
 to create a <tt>CoAP</tt> server and a <tt>CoAP</tt> client. 
 <ul>
 <li><tt>python3 <a href="../resources/python/coap/basicrobotAiocoapServer.py" target="code">basicrobotAiocoapServer.py<a></tt><br/>
 
 The server provides a resource (<tt>BasicrobotResource</tt>) that implements a <k>PUT</k> request by 
changing its 'state' and by sending a command to Arduino on the Serial line. 
</li>
 <li><tt>python3 <a href="../resources/python/coap/basicrobotAiocoapClient.py" target="code">basicrobotAiocoapClient.py<a></tt><br/>
 The client provides a simple console to send commands (<tt>w,s,a,d,r,l,z,x</tt>) to the <tt>BasicrobotResource</tt>.
 </li>
 <li><tt> <a href="../resources/usingCoap/basicrobotQakCoapClient.kt" target="code">basicrobotQakCoapClient.kt<a></tt><br/>
 A client wriiten in Kotlin that provides a simple console to send commands (<tt>w,s,a,d,r,l,z,x</tt>) to the <tt>BasicrobotResource</tt>.
 </li>

</ul>
 
 
</td>
<td>
 
</td>
</tr>
 </tbody>
</table>
</center>
<br/><br/>

<h2>Using HTTP and CoAP together</h2>

<ul>
<li>
<a href="https://www.deviceplus.com/raspberry-pi/raspberrypi_entry_030/" target="code">WebIoPi<a>
 solution: the HTTP server redirects POST commands to the same handler used by the CoAP server.
The Web page given by the HTTP server contains a script that <k>DOES NOT work</k> as a CoAP client observer.
Rather it performs polling over the resource state to be updated.  <br/><br/></li>

<li>Unibo solution: the HTTP server handles a POST command by generating a CoAP request and by sending to the HTTP client the same
answer given by the CoAP server (that interacts with Arduino). The HTTP server works also as an observable CoAP client
and updates web pages by using <k>socketio</k>.</li>
</ul>
 


 
 

<h2>Actors via CoAP</h2>
 
 <table style="width:98%">
<tbody>	
<tr>
<td style="width:50%" >
	<ul>
 	<li><a href="../resources/usingCoap/basicrobotQakCoapClient.kt" target="code">basicrobotQakCoapClient.kt</a></li>
   	<li><pre></pre></li>
	</ul>
 

</td>
<td>
</td>
</tr>
 </tbody>
</table>
-->
 <br/><br/>
<table style="width:98%">
<tbody>	
<tr>
<td style="width:50%" >
 

</td>
<td>
</td>
</tr>
 </tbody>
</table>
 <br/><br/>
</div>  

 
 
<tbody>	
<tr>
<td style="width:50%" >
 

</td>
<td>
</td>
</tr>
 </tbody>
</table>

 <br/><br/>
<div style="background-color:rgba(86, 56, 253, 0.9); width:100%;text-align:center;font-size:small;color:white">
By AN Unibo-DISI  
</div> 

</body>
</html>

<!--
<h2>INSTALL PYTHON</h2>
 <br/><br/>

<table style="width:98%">
<tbody>	
<tr>
<td style="width:70%" > 
 <pre>
---------------------  INSTALL PYTHON
DEPENDENCIES
sudo apt-get install -y build-essential tk-dev libncurses5-dev libncursesw5-dev libreadline6-dev libdb5.3-dev 
libgdbm-dev libsqlite3-dev libssl-dev libbz2-dev libexpat1-dev liblzma-dev zlib1g-dev libffi-dev 


wget https://www.python.org/ftp/python/3.7.6/Python-3.7.6.tar.xz
tar xf Python-3.7.6.tar.xz
cd Python-3.7.6
./configure --enable-optimizations
make -j 4
sudo make altinstall
# It will created the binary and lib dirs with the version in /usr/local. 
# This way you can choose which python you want at run time.
python3.7 -V       #check the version

sudo ./configure --enable-optimizations
sudo make -j 4
sudo make altinstall 
# It will created the binary and lib dirs with the version in /usr/local. 
# This way you can choose which python you want at run time.
python3.8 -V #check the version 



wget https://www.python.org/ftp/python/3.8.1/Python-3.8.1.tar.xz
tar xf Python-3.8.1.tar.xz
cd Python-3.8.1
//To overcome the problem No module named '_ctypes'.
git clone https://github.com/python/cpython.git

 
 
</pre>
<pre> 
/home/pi/nat/cam-robot/WebIOPi-0.7.1/<ks>python/webiopi/__main__.py</ks>


	server = Server(port=8000, configfile=configfile, scriptfile=scriptfile)
Configuration file in <ks>python/config</ks>  (<kc>HTTP, COAP</kc> enabled) See also <kc>python\webiopi\utils\config.py</kc>
			self.restHandler = <ks>rest.RESTHandler()</ks>   //in <kc>python\webiopi\protocols</kc>
			<ks>http.HTTPServer</ks>(self.host, http_port, self.restHandler, context, docroot, index, auth, realm)
			<ks>coap.COAPServer</ks>(self.host, coap_port, self.restHandler)
	runLoop()
	server.stop()

sudo python3 __main__.py -c /etc/webiopi/config


</pre>
</td>
<td>

</td>
</tr>

<tr>
<td>
 
</td>
<td></td>
</tr>
 </tbody>
</table>
 <br/><br/> 
 -->
 